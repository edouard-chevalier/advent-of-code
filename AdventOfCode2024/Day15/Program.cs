// See https://aka.ms/new-console-template for more information


using Template;

const string inputReal = @"##################################################
#.....O..O....O.#.OOO...#....#....OO......OOOO...#
#O......OOO..#..O...O.#........O.OOOO.OOO........#
#..#..O.O..O.......O....#..O.O..O.O#...OOO....O..#
#.......O..O..O.O.#..#......O#..OO...#..##..O.O..#
#.#...O....O......O...O#.OO.....OO..#.O..O.......#
#OOO.O....OOOOOOOO.O...O..O.O..O.........O....O.O#
#.O...#.##.#.....O.O.O...........O....OOO#OO..O..#
#.OO.O.O.....O.#OO......O.O#.O.O........OO.O.....#
#...O....#OOO.OOO.O#.........OO#.O....O.O..O.OO..#
##O#O#.....O..O..#...O.........O.O....O..#OO#..#O#
#.OO.O.....#.O.#.O....O...O...O..O....O##O..O#O..#
#.O..O.O......OO.#..O...O.O..#....#...O.O#.##..#.#
#......O....#O..O.....O.......O..O....OO..#..O..O#
#.#.O....O..#O.O...O.#...O..#..........OO...O....#
#OOO...#O....O..O..OOO..O......#O..O#O.....O..O..#
#......O......O..#.....O.....OOOO...OO.OOO.O.....#
#.O.O..O.O..#.....#OO..OO.#O..OO..O.O#O....O..#..#
#.O.OOO..O..OO.........O...OOO...#..OO.O.O.....#O#
#.......OO..O...OO......OO.......O.O.O..#..##.O.##
#O..O.O...#...OO....OO.....O...OOO...#O..O.O.....#
#..#.O.#O..OO.OO..O..#OO#..OOO.....O....OO.O....O#
#O...O..O#..###..#OOOO.O.O.O.O.....#OOO....O.OOO.#
#....O.OO.#..#........OO......O.#..O.O.O.........#
#.O.O#O....O....O#..O.#.@.....O..OO.......OO..OOO#
#OOO........#..OO#....#.O.O..#..O#..............O#
#..O.OO.O.O.O#.OO.OO#OO.O....OOO.#O.O...OOO..O#..#
#..........O..O.....O..O......O......#OO.OO..O...#
#....O.O...O...O.O.O.OO.#O.......#O.O...O....O...#
#......O..OO......##....O#O....#.O.....#..#.O...O#
#..O...O...O..O.#.....#OO..O.O#..O....O.O.....O..#
#OO.....O..O.....OO...#........O.O#O..OO..O....O.#
#.OOO..O...O....#...O#O.O.O.#...O.O.....O..OO...O#
#.O..O......O..#..O.......#.OO..O.O........#.....#
#...O.O.O..OO..OO.#.O..O...........OO....O.OOO.###
#O....#..#..#.....OO..O..OO....O......O..O#......#
#...O.O........O..#.O.O#.....O.O.O.O..O..#.O.O..O#
#...OO..O.....O............#.....O.O.O.....OO..O.#
#OO#O.O.O#..#.#..O.#....##.OOO......O..O.#...O...#
#..OO....O.......O.....O#...O.......OO#O...O...O.#
#.#.OO.....#OOO..#.......O.O.O....O..............#
#O........#.O.OO....OOO..O.......#.OO.O.O....#...#
##O........O.O..#.....OO#O.O.OOOO.#...OOO.#O#O#.##
#..O....O.#OO....OOO.##.#O..O..O..#O.O..OO.......#
#O...#..#O.O.OO..##.O.O..O......O.O.O...#OO.##O.##
##..............OO...O..O........#.....O..OO..O..#
#.O.#O.OO...OO.O.O.O..OOO....O.O.O...OO.O....#..##
##O.....O#....#O#..O##......##.#OOOO.#.OO.O.OOO..#
##.O......#........OO#.O..#.#..O.O.OO.#.O..O#.O.##
##################################################

<vv^><<vv>v>v>^^><>><<^vv>^v>^>^>>>^><>^vv^v><v<^><>><v^^^v>^>>>^^^^>>^v^>^v>vvv<<<<>v><^<^<><><><v><><<<^>><><>v<>^>><<<v^vv><^<<^v>>^v^^<<<>>vv^^^^<<^>>^v^><<v<<><>^<vv<<v<^<<>^<vvv>^><>vv^^v>><v>^^^>v^<v^<^<v>v^vv<^<v>><^vv<^><<v^^<<^><vv^v>v<><^<>v<v^<v^>v><<^>^^^<><<><v<vvv^>^vvv^><v<<v<><<^<v><v>^>><^v>><>^v<^^v^^<v<><^>>^^vv>>^^^<^v><<^^^>^^><^>vv<><<v<>>^v^<<^><^v^^v><<v><><><vv<^<v<>v<<<<>vv<>^<<<v>v>>><<<^v>>^^>vv><vv<<v>^vv^v<^><v<<^<<^<>>^v>>^vvv^<>v<^^^<<v>vvv>vv^^<vv<<^>v<<><>>^>v>>vv<<^vv^^^<<v>^^<^^^^^vv><>^vv>^v^^<<>>>^v^v>^^^<<><vv>v><v^^^^<<^>>^<>v^v<^^<v>^^<><><><^^>>v<v>^>^><^><v><<<<vvv^><^^^v>^^<^^v>^>v>>v>>>v^<^>vv<>^v>>>^>vv^>v^<>v><^><<v<v><><<<vvvv>v>^^vv<>>v^^v>v^^<^>>><>>vv>^<vv^><><><<<vv<>v<^v>>v<v<v<^<v><^vv<vv<^>^<vv><v>>v>>^>^v<><<^v>^^>v^v<^^^>^vv>^^<<v>^v>><^>^>^<>^^<^^<v>v<<>^>>^v<v^v>v<>v^^>^<v<v>vvvv><>>^^>>^<v<v^>>^v^<v>^v^^^^<^<vv^><>vvv<v>^<vvvv^>^^^^>^^^^^>v^v>v>>v^><<v<<<^^vv>><<v>^>>^<^>>v^<<v<^vv>vv>v<<^<>v^>>><v><v^v^v<v<v^>^^^v>v>^^v^^>v<
v>>^v<^><^><<>>><>>v^<<<>^^<<^^><><>vv<^<^^^<<^<v<><<<vvv<v^^v>^v>v<<>v<v>v^^><v>^v^^<v^^^<vvv><<^<v>v^^v>>>^^<v^v><<<>^^>^>v<v^<vv^>^<<^vv>>v^>v^v<<<v^v<v>^>v<<vv<^^<^v><>^<>v^v>>^v<v^v^^v^>^>^>>vv><^<vv>><vvv<v^<vv<>vv^vv^^<>vv>^^<<<<v^>v>^^><><v<vv^v^^<<vv>^^<^<<^<>^<<vvv^^v<<><v><>^>>v^vv^v>><v<v<<<^^^^^<><^<><><^<<<>^v^v><^<^^^^v^<v^>^v^<v^^<<>>>^^v>><>>>><<vvv^<v>^v>>>v<^^<<^^><>^^>>^<^<>>^v><v<<<v>>>v>^^<^>>^><^v>>v><<v<v<^^<v<^^v>^^<><><>vv^^^<v^<v^^vv<vv^^<<v>>^^v>>v><><<v^v>^>><><^>^^^<^^v<>^v^<<>>vvv<<^<v^v><<>^<v<>>v<v^^vv>^>>vv<<^<<v>v^v<v>vvv^<<<>^<vvv<>^^vv<^<^^<v^>>>><<^>>^^^>^v><v<^^<>>>>v^v<<vv>>^vvv<^vv<<v^^<^^<v>>^<<v>^>>^>vv^v<>>^<v>^>>^v<>><^>>>><<<>^v^^v>v<^v^^vvv<<>^><<v<<v^v>v><>^v<<^^^vv<<<<<<vv<v^^>v<<vv^<<v>v^v<<v>vvv^<vvv>v<v<>v<<v<v>>>^>^^v^<><<<>^<><>^>^>^>><>>><v<^<v<v<><<>^>^v<^^<>>^^<^<<><<<<<^^v><<^<v^v^<<^v^<<^>^>><^>^v<v<^v^>vv<>v<>>>v^^^>^v<vvv^^<^<vvv<^<>>><v<v><v<^<vvvv><^<<v<<^<<<^v^>v<>^v<^>>^>^>v>^^<><v>^<><<^<<<<<<>^v>>^><<><^^>>^vvv>^v>v>^<<
>><^<>><>vv^v<v>^>vvv>^<<<<><>v>v^<v><<>v^>>^^^^<^v><vv<<<><<^<v>>v^<vv^>^<v>^<v<<v>>vv<v^^v>^>v^v<<>>vv^><v<<>>^><><<^v><v^^^<v>vv<<<>^<<v>vvv^v<<^^v^^^><<^<vv<><^>v<^>^<<^v^<vv><v>>v<>^<<vv<^<v>^>v<^<>>^v<^><>><^^^v<<v>>v>^>^>>v<<><^v^>^<^>^<>^>^^>vv><<vv^>>>^<>^vv^v^<v>^>v^>>^><vvv^v<v<>vv^>^><v>^vv>^vv<>^<vv><<v<v^v>vvv><^v<><>^^^^v^^v^<v^<^v<>^v>>^v^v>vv<^<>><><vv<v^^>v<vv^^^^^^v>>><v>vvv^vv>^<^<>v^<^^<^<<<<>><<<v><>vv^>v^<>^^<>>>v<>v<<><v^<<^vv><<v>>>^v<>v^<>v^v>v<v^vv>^^><<^v>vv^v>><v><v<v<vv<<><^^<v^vv^^<<>v<<v<vv>>^^<<^<^><v<<<^<^>^>>^^<>^^v>^>^><^<<<<>v^>>><^v^v<v>^<^^<>>v<^>v^^<vvv<^v>>v<><vv>^^vv>>^<^v^^^v>><^<^^<vv<<vv^^<v><v^v>vv>^v<^^>v>v^vv^v<^<>^<<>v>>><<<<>>>>vv>><<v<vv><v>><>>v^<^v><^^^<>>^>>vv^><^>vv<<v<><^^>^><<vv<<>>v^<^<^<^<vvv^<>^><<<^>>v<>^>v<<><vv<<>^^v^vvv>^>vv^<>v<^>v<^<v<^><<v<>>^v>v^<<v><>^<^<>v^<^^<^>^^>^<>v>v<v^^^>v>>>v^>>vv>>v><v>v>^^^<v>>^v^^^<>><<v>^vv<^vv^^^^^>><<v>^^<<v^v>v<>>vv>v<>^^v>^>^<<^^^^<v>v^v^<<<v<^>^^>^<v<v^<^<v<><<><v^<^v^^^^v^<^<^v<vv>v>
v<^^<>v^v<><<^^<v^>><<>>v<vv^vvv>v<>^>><>><v^<v>^>v>v^v<><v<<<<<<v^v^<<>vv<v^<^<>^<<^^vv<v<>>^^v<<vv^>v^>^><>^v>^^>^v^<><>v<<^>>v<v^<^<<><<^><<<<^v>>v^v<>v>v>>v>><vvv^v>^^^^<>^<v><>vv^<>^v>^<>>>>^<v<>>><v<^><v<^^<<<<v^>>>^<v<^^>^<^^<><<^>v^v>^^>><<<<v><^^^>>v^>><^^<<vv>>v<>v^^^v<^v><<^v>vv^vv<^>>>^vv^>v<>^<>v><^>^v><<><>v>^><v>^<v><vv^^^>v^^^>v^<vvv^v<v^vvv^v>^^^<v>><v^>>v>^>^v>v<^^^>^>>v^>^v>v^^^^<v^v<v^^v><<<v<v>v^^>v<><v^>>v^^^^>^<v<>>><^v<><v^^^^^>v^^^><>>^<^v<v^<>v>>v<>><vv>><><^<>v<<^v^vv<v<><v>>v^^^<>^>^^>>>v>>^<v>^>^^v>>>>v>><>>>^v^<v<>^^><<^^v^<<^<^<><<v^v<<>^^^<^<>v^^<<>v^<>>><v^>>>>><^>^^vvv<>v<v<>vv>v><^><<<><<vv<^>^v<<><>>>>^^>v>^^<v><>>>v<<>><>v^vv<^^v<vvv><<>^<><vv^<^>vvvvv<<v<v<>^^v>v^vvvv<><<<v>v<^>v>>>>^>^>v>>v^>><^vv>^^<v>vvvv<>v<^^>>^<<><<<^<<vv<<vvv^>>>v<<>><<vv^v><>v<>>^><^<vv^^>v<v><v<>^<^v^<><v^<v<<>><^vv<<v>><<^<v<>>^<^>^^>>v^v><v^v<^^^v>vv>^^<><v^<v>v>v><<^^<v<v<^><>><^><><^>^^v<^^<^<><v>>>v<vvvv^<<>><v^<<<<^v>v><vv<^^<<^^>v>>vv>^^v>^vvv<v^>^v<>>>vv<v<<<>v><<<
v<^<^<<vv^<^>v^>^^>>^^><<^<>v>^>v<^>^vv<^>v>>><<^v>^^^<<<<v^<vv^^><>v>v^vv>v><<<<><v<<v<^><<v>>>><^v>>vvv<<<^><<v<<<^><^v>^v^v^>^<<v>^^<^>^<>v^><<>vv<^<^<<v<<>^^^>^v^>>>^><<<^v<vv^^>v^^><^^>><<^<^^^vv^v><>>^v^<^v<><>v^><>v>v<>^>><^^>v<<v^>v>vv^<<<^>^<vv^^v<v^<<><vv<<^>^v<>v^v<><><><v>^>>^><^v>>><<v<>^^>^^^v<>^<v>v<><><>>>v<^<<<<v^^^^v<vv^^<<<<v>^^v>><v>>v<<<^vvv<>^<vv^vvvvvvv<>>>>v><^>><^><vv>>><>>>>^v^<^^><>^><>>>><vv^^>v>>>>>v^vv^<v^><>^>><^<^<v><><<>v^<vv>vvv<^<>>v<<^^>>^<>^^vv<v^v<vvv^>>><v<v<v^v>vv><^<><>^<v<<v<^vvv<vv>v>>v>^<<>^<>^^v<>>^v>v^v><><^><v^>vv>>^<<v^v<<<v<^<^v^<^<><^^^>>>v^v>v<^><><<^>^<^v^<><^v<v<>>v<<^^<>^<vv>v<<v^v^vvvvv^v>^><vv>vv<<^^vv>>^vv<<^>>^^^>><>vvv<>^>v><<<>^v^><^>^<<^^v^<<v>v<v>><><<v><^>><<^<^<<>>vv<<^vv>^^<<^<>^^<^v<v^v<^<><>>vvv><<>^>vv><v>>>v<<<>v>vvv<><><vvv<><vv^<v^^><<>^v<v<<<^<<<><>>>^^<^v<v<>v^<<v><<^<>v<>v<>^v<<<>^vv^>>^^v>v<^v<^<v<v^^><^^<<^<v><<v^>>v^>v^<v^^^v>^^>v<^vvv<v<v<<>>v^>v<^^>>^v<<^>vv<vvv><<v<v^^^<vv<v^><<v<^<^v>v<^v^>v<<>>>><>^^v^>>>
vvvvv>vvv^vv<^>^v>><><>v^^v>^v^<<<^>>>vv>^>^<v>v>v<<^v<<v>><><<^v<^^v<^^^^^>v>^>v^v^^<^v^<v><<<<^>>>v<<<^vv^<^>>>v<^>^v<^<v><<^>vv<>>>^v>v>^>^<>^^><>^^v<v<^>v><v>>^vv^>vv^><v><>^><<^<v<>^^^vv>v^v^v<v^vvv>>>vv^vvvv^>>v^^<^<>v>v<<v<>^<^<^>v<>>^>v>^^<^v><>^<><>v^><>><^vv^>vv>>>^<vv<>>v>v<vv^vv><^vv^<^^<<^v<<>>^>v><vv<<^v<>v<^v><^>^<<v><v>vv<^<<<^<>^>>v>>>>>>v^<<vvv^<<v^<v><<v>>^<^><^>v^<><>>^<^^<^<>vv^>^>v><<<<v><vvv><^>^><>^^v><^^v><v^v>^<<^^^v<<>^>^vv<v^vv^v>><vv>>^<<^v<v<>vvv^<^v>>>^<v^v<vv>^v^><>v>v>>v>vv<^<^v>^<<>v^>>v>v<<<vvv>>v<>><<<<v^<<v>><<>>>^<>><^<v>^^^>^^^v^><<>>><^v<>>^>>^v><<^^<v<v<>v^^<><^^>>>vv^>v>>v^<>>>>vv>><v<^<^<^^^v>>v>v>vv^>>^^^><v^<^^<<>v>^>><>>^^vvv><>v>v^^>v^v<<v^v<<>>><>^>>v^>v^v^v^<<<^<><v<v><v^^<vv><<v<^v^>^^>>vvv>v><>^<v>v>>v<<><v^>><^v<<v>^^>v^^v^>vv<^><>>><v<v<><^<v<<>>^<<v>vv>^<v>vv>v><<vv>^>^v<^>>^v<<v<v><<v<><^^^^><^<^>v<^<^>>v<<^>^<v>v>^^^>^^>^^><v><v^><<^^^<>v<<^<^v^v><<>^^vv>^<<<<><<>>^^^<^vv^v><>v<<^>v^^^vv^^^v>>^^vv>>^^<^^^v>>>vv<^<vv>^<><>>vv>v<<<>
^^>^>><<<v<<>>>^^>v^<v<>v<<v<<<v<>>^>><v<>>^^^v>><<>>>><^^vv^>vv<<v^^v<<v<^>v<v^v<^>^^^v>v^v<v>>^v<^^v>v>v>>^<v<<v>v^>^>^^<v^vv>>>v^<^v<^^^>>v<vvv<^<^<^v<^>vvv<>vv<><v>v^<^^v^^vv<>>vv<v<><v><>vv><vv<<^><^<<<><<v<>^v<><^^v>>^>^^^>>^v>^v<>>^>vv<^^^^<><><><<^^^<^><^<v^v^v^^vv>v^^v>>>^<>>><<^^>^<<^<v><>>^^^>v<v<v<>><>><><>>^^v<<^^v>vvvvvv><v<<<^>^<^><<>>v^v^>v<^^<><vv<v<v<<><><vv^v^^v<^^v>^v^^<^>v^>v<v^vvv<^>vv^>>><v>>^v>>>^<v<v^^v<^<^^<<v><vv^>vv<v>v^v><^^>^^<^v<vv<>><vv^<>>^>>>^>>>><>><<^^<vv><v^<><<v<<vv^^v><<^<^<<vv^v<<<<<v^>^<>vv<>^vv^>>^>vvvv<<<vv<^v<v^^^^v>><<v>^v><v<>>v<^v<v^>><^^^v>v^v^vv>>v^><<^v<^v<<>><v>><v<v<>>><vv^<v>v^v<^<>>v<>v^vv^><>><v<vv<<v><>v<<<v^<><^>v<v><>vv^>>vvvv><<><>v>v^><<^<^>^<<vv<v>^^>v<vv>>vv>v<vv^>vv<<^v^vv<>v<vvv><^vv^vv^<<<^<v^vvv>>>>v<v><^>v^>vv<vv<v<<v<<v<v>^v<<v<^<^>^vv>><>>>^v>vv>>^<v<<<<^^><^>v><>><<>^<<<v^<v^<^<^>^^<v<>v>>v<^<v^><v>^>v^^^^><<><^<>>v^vvv<v<^<>^<v>v<<<vvv<v<<^<<<>^<v<^><><^<^><v^>v^v><^<v^<^>><v<>v^>v<v><^vv^<>^vv>v>><v<<>v^vv^<<><^vv^
^><^^^^>v<^<>^>v>^^^^v^>v><vv^vv<>v<^v<^<>^><><^^><v<^<v>>^^>^<<<<^<v>>^<^><^<><^^><v>v^>><<>v>^^^><<<^^<>^<^^^>^v><<^^<^><<^^>v>^<^<^^<>^^<^>^><>v<<<<v>^<<^v^><v>v<>^>v<^^vv^><<>^<^vv>vv^^v^<v<^vv>^>^^<>^^vv<<v>^^^<<^<<v<<<vvv<vv<<^<<^^^>^^^^^<vv<^vv<>^<v<<>><^<>>>^^>^v<>v<v>^><>v<^v^<>^v^^<><<v^^<v>^^>>^v<>>^<>^v^><v><^^<v^>>^v^<<^<<v^>>^<^>><^><^^><>>>>vv^><^>>^v<v^>vv>>>>><v^v<<>v><<>>vv^^>^>><<v>>^^v<<v^<v>>^<<^>^><v>^<^>v^v<>^<<v<v^>>>^>v<><<v>>>v^>v<<<^<<v><v><vv>>>>v^<<^v>^<<v<>>>>>>v<<vvvvv<>^v<>^<<<^v<>>>^^^^>v^^^^<v<<^<^><>^v^^<v>><^^^<vv>^<<><><><>vvv>^>v^^>^>><<^<v><>vvv^v^^<>v><^^v<v>>v^><>><^v>^<<<^^<vv^<><vv^><^^<vv>><^vv><^>vv>v^<>^>vv^v^<>^<<v^^v>vv<^<v><<^<><>^v>^>^^<>><<^<v^^^^^><vv^><>v^<>v><<<v^><<<^v^>vv><v><v^^^><>>><>v^^>><>>^>v>>>>>v<<^^v><<v^<v^v>^<vv^><>v><v><vv<>v>>>^^v>v^>v^<^^^v<v<v<v^^^v>vvv>>><v^<^><>><<<>><<v^^<><<^v>>^v><><^>><^^^<v<^^><vv^<v<v<v^v>>v>vv>^v>v<>^<v><<^^vv^^^<^v<v<v<<<>^<>v^^>>^<<^^^^<v><^v>v<v<<^v<<vv^^^<<>v<^>>vv<><<<>v<^<<^^>>v^>v>^^
v^v<^>v^v^>^^<v>>^v<<v^vv>v<><^v><><v<^<v^v<>v^<^v>>>v>^vv<<^<vv^^<>^>v<^^>v^^<v<v>^<><>^>^^^>^^^>v^<<v<v^v^^<<>v>vv>><^^><>vv^^<v<v>v><<v>vvv>^<><^<v^^>^>>^vvv<vvv>v^^<<>v>vv<^<<<<>>vv^<vv^>^v>vv<v^v<v^^^vv^^vvv^<^^>^<vvv<v<^<^>>vv<><<v>^<v<v^v^<>^<vv<><^^v<>^^^<<v>v<>v<>v<<<<<>><<^<>v^>v>^>^>^^<^><><>^<^v<>^>vv<^<^<>v>vv^<v^<><>v>>><v^v<>v^vv<>v>^><<v<v^>^>><^^vvv<<<<>v><>v>vvv>v^vv<>v^v<<><<vvv^^<<>^>>^^>v>^v^>>>^v<>^<^^><v^<>^<>^>>>^<<<>vv>v<^^vv<v^vv<>><v<>>^>^^v>^<v><>^v>^^>^<<^^^^<><^><<v>^^>v^vv^>^v><>>v>^v^^>^<^^>v<^v^v><><<v^>vv^^^>>^><>^vv<>^<^<<vvv^<<>>vv>^^<<^<>v<^<v<>^^><<<^<^<^v^<^<>v^>>>><^v>v>^v^<>^><^^>><><vv>vvvv^>vvvv^v<<><v^vv^^>><<vv^>^^>><>>^v>>>^>>^^>^>^<<>>><v<^<v<vvv^><<>v<<^v>>vvv^v<^vv^v>v>>^>^>^>>vvv^<><><>^v^<<<^>>>v^<^<^<<><<><<^<v><<v<^<<>>><<v^>>>>^v<v><<v>v>^vv^<<vv<v^<>^v><<<><^v^^>v<v^><vvv><v^v><<^^>v<>^^^v^^>^^v<v<v<<^<^>v>>^^<<>v^^^^v<>>^^vv<<>>vv^^<^<<^>v^^v<v<>>v^>>v<^>>><>v^>v<>>>^<<vv^>v<<><><vv>^v^>>v<>v<^>v><>^<>vvv<>^<v^<<^v^^vv>v>vv^v^<v><
<>^><>v^<<^^<>v><>^^^<^vvv>v<^v<v>^><>v>vv>v<<<<>v>><><vv^>>v<v<>>^<<><>v<>>>>><^^^^>^v><^<v<v<^v^vv<<>><>^<<>>^><^<v^v^><<<>v^><^v^vv>v><v><v^><><><^<<><<^vv<v^>v^v^v>v>v<vvvv>>>^^v^v<>v^^vv>><<<<<<>><^^^v^<vv>>>v^<><>^v<v<<<^v><v>^>^<<^<^<v<^<v^<v<<v><v^^^<vv>>^^^v^>>>>v>v>>>><^<>>^>><v<>>>v>>vv<<>^^><><><vv^v>>><<vvv<v><^<<^<v<^<<>v^^>v<vv<>v<>^v>^^<<><^vv><^><^<><v>>^>^v<vv<><>><<>^v><>v^<>><<><>v^^>^>v<<><v>v^vvv^<>^^>v<<<<><^<<v><><v^^^<v>v^<^^v<<>v<<vv><^<><v><>v>^<vv<^>><><>^<<<>vv^>^<^>^>^v^>^>v>vvv<v<v>^^>^v><^>>^^v^<<^><^^v<^^^v><v<>v^<><^^<v^><v<<v^><>^v^^vvv<>^<vv^^v><v<><<v^v>vv>v<<<<<>v><vv>>^^>v<vv^<^vvv>>vv<v>v<>v<>>>vvv<>^<v^<<v<^v^v^>><<^<>v>^<><<<<^^>v<^><v><v^<>v>>><^v>><<>v<><>v^^><>>v<>v>><^^v<^>>vv^>v^^>vv><>>>vv>v><v^^<^>^^^<v<>^^v<^v^v><^^v<^>^^><>v^^^^<^v^>^v^><v^<^<>^<vv^<>><<^v>v^<<>>^<^<<<><^><>>v^v><v>v>^>^^v>>^>>^^^^vv<>^^>>v>^vv<<<>>v^vv>>v^^^v<>v<^v^^v^^<^^<<<>^<<>^^^v^><>^^>^<v^><><v><^<>^^<v>^^>^>^^^v>vv>^><vv^v><><^<vv^^^><v<vv>>v>><<v<v<v<>v>>^>>^v
><<^<^<^>^^<>>^^>>^v^<><>vv^><<v<^>>^^v^<<^>v^v^<><<>^><v<v^^>><>>^>v<<>>>v><v>^^v>^<v>v^^>>>vvv>^v<>v<<>^<<v^>v^<>^v^^>><><>v>>>vv><v>vv^vvv>^^^<>>><^^^v<>v>^<^v>v^^vvvv^v>^^vv^^<<>><v<<v<^>^^<>^<<<v>v>^>^^v^>v^<^<>>v^<^v<vvv<v><>>^^><^vv<<<<>v^v><>^^><^vv><<<<^vv>vvv<>v^<<^>v^^v>v>^<<^>><^v^v<>v>>v>^vv>>v^><^^^^<<<>^^<v^^v<v<v>vvv>>^^<<^>^^<^v<<vv><>^<v<^v<^>v^^<>v^>>^^^v<>><v<v^^v^<v<v^v^>^>>^>^v<><>^vv><<v^^<>vv>vv<<vv^^^v^v^v<v<^><vv^>^>>><<>^><^>^>^^^<<v^>>>><<>>v^v<^<v^^v^^^<v<v^v^^>v>v><v^><>v>><>^^>><<^vv<<>^v<v>^<v^^v>^<^<^>vvvv^^v^>vv<<<<>^>>>><v^^^<<<>^>v^vvv><vv><>>v<^<^v>^<>>>vvvv>^vv^^^v>>^v>>^v<v>^>vv>v>>><vvvv<>>v>v<<>v^<<^<<^>>vv<^^<>v>^^vv^v^^^^vv><>>vv<>v^^>^vvv^^<^<^^v^^<vv<v<v>vv^^^^v^>><>><<v>^v<^^^>>v>v>v^^^^v><^>>v^<<v>>v<^<vv>vv<v^<>>^^^>^<>><vv>^<>>^^^<><^<^v^>>^v>>^v<^v^>><^><vvv^vv><<<vv>^^<>vv>>v<>>^><v^>v<<<<>v<>^>^<>v<v^><^^v<^><v>>^v^^>^<><>^>^><v>>>>>>vv^>^^><^v<^>>^<<>><<<v<v<^<<<^>>vv^>vvv<><>^>>>^v^^v^vv>v>><<^^>vv<<v><><v^><v>>>^^v<<>^<v<<>vvv><><v
^<>>vvv^<<^<v<>^<^<^>v>v>^<<<^^<^vvv^<^>v^^^vv>><>^vv>v^^v^vv><^^^><>>v<v>^><>^v<<v>><v>>^>>^v^>vvv><>v^<>>^<<^<>^>>v^<^<>^^^^<><v^v<v<^^>^>>^v>v>vv^<^<^v^>^v^<>vv<>^^<>^<^<^v^<^vv<^vvv^^^v<>^^vvv<v^^>v>^>v<^<^^^<>^<v>>><v^vvvv<>^>^v>v<><>^v<^^v><^<v<v<<^^^^<v<^>^^<vv><<^<<^>^<^vv>v^>^>><vvv><<^>>>^<>>v<v^<vv<<^<><<^^<^><^<>v^>^>^<^><v^<<^<vv><<<<^<v<<>^^v<>>v^v<<v^<<<><>^v>>>^^<v>>v^<v<v^<^^^v<<<><v<^>><^v^^>>><>>^<v^vv^v<v^<<v^<v><^^>vv<<<vv<<><<v>vv<v<>v^<<<v^v^v^>v<^<>>v^vv>v>v<<><>v<<<^vv^vv^>>>><v<>>^v^<>v>^<<>><<<^^<<>^v>^>>>v><<v>>vvv>>>^>>v><^^>^^^>^>^v^^v^>v^^^^<^v>v>^<v^vv>>><^><^vv^v<>^^><^v<<^<vv><<^^<<^<>>v^><v^><<v^^^^<v<^<>>v^^>^><<vv<<<v<>^>^>^v<<^>^<<^v^vvvv<vvv<<^>>v>v<^v>^>^v^>v^^v<<>><>v^^>^vv>v<>vv^><^>v^vv<><v<^v<>vv^<^>>>v<>v<><v>v><>^^><<>^^<^vvvv^v^v>v>v<<^><<>vv^<v<<v>^<^v^<vvv><^<<>v><<^^vv>^<>^>^^>v^^>v^>>>^v^^<^^>^<<^^<vv^^^v^<^<<^><^>v^>>^>^>v>vvvv^<<<>^<<v^>^v<<<v^vv><>v>>^^<><v<>>^>^>>>>v^<v^^v>v>^^vv^^<^v>v^v>v^^^>>>^^>>^^^v>>vv>^vv^^^^>>>v<^<<><v>^^>^
><v>^^vvv>><<^<>v>v><><<v^^>v><vvv^^>v<<>v<><v>^^<<^>><<>vv<<>vvv<v<<^>>><^<<v>^<vvv<<^^^vvvv><<v>^><vv<v^><^v>^v^>v><v^v^>>^><^>><v>^v^^>><<>v^>>v<v<v<v>v^^^v<>>v^<<vv>>>^<>^^>v>^<v>^v<<vvvv>>^v^<v<v><>^^>^v<v<<^^<>v^>^^>vv<<>^^><^^><<vv>>v>^^^<v>>v<^<^vvvvv><<^^^<^<<^<<<^<>>><^>>>>><v^<>v<<>v>^<<<^<<^vv><v^v<^><>><v<^>^vvv><v>v<><>>>vvv^<^v<v<^<<<v^>>^<v>>>^<><<^>v<>^v^<v<v<><v^><^^<^v><vvv^vvvv>^v<^>^<<^>>^v^<<^>>>><>vv<<^v^v^v<v<^>v>><v^<^<v<>^><^^<<^^^>v^v<^^v>><<>^vv><><>>v^<>>>^>v^^<v^^^>^v>>^v<^>v<>>v>v<v^^><>>><v>^vv<^v><v>vv>vv><v^<<<>>>^^>v^><^vv>v<^v<<v^v<<^<>^><^<>v^>v<v^>>^^v^v<^>^><>><^^v<<<vvv<<v^^>^v>><^vv<^v>>vv<^vv>><^><<<^^^<^>vvvv<^v>>^v>>v^>^vv<v<v>v><v<>^v<>^vvvv^v><>^v^^><^>v>v^><v^^^<^v><v^v<><<v>^<>^><v>>vv^<<v^v>^>>v<<^vvv<>>>v^v><><<<<v><v<>^^><<v^v<>^^v<vv>><>vv^<>v<vv<><^<^<<v^>v<>>>>^<^>>v>vv^<^<>^^<<>>vv<v<^>^<^>^^>>v^^>><<v^^^v>vv^^^v<>^v^>v^>>v>^^<^<<<^vvv<^vv^^^^v>>><v^v<^v>><<vvv><^^^<^v>><vv>v><vvvv^^<>>^^vvv>v^vv<^<>vvv>^^^>><^>v^<v<>^><>>v^>>^>>^>
^v^<^vv<^v^^^><v<^><^<v<><^^<v<>^>v<vv<vv>v^>vv^<^>^>>v^<<>><>^<<^v<v>^>v^vv^v<^v><^<v^^<v<><v>v<>>>^><vv<<^>^>^<^<>^v>v>>v>v>^^v^<<vv<^<v^>^^<^<<>^v^v^^vv<<<<^v>>vvv>^><v<^>>v<^^vv>^^<^<v<<><v^><^>v<<><v^v>^v^>^>^>v<><v>>>^^v<>>v<^<vv<vv>v^<v<>>v<<<^><^>v<vv<>^>><^v>^^v^>v^>v>>>><<><v^><^<><^<^^^<^^>>^^>^<v^><<v^v>v>>^v<>^^^^^v<v^v><>^^v<<v>>^<^v>^^<<^^<^><vv>>^>>>v^>><><v^<vv^^>vv^^>>v<vvv<^<^<><>^>v^v^<vv>^^<v<><vvv<v<^<v^v>^>><><^<^>^^^vv>><<^><><^v>v^v<^^vv>^^<^>>v<^><<^v^<<v^^^^>v<v<>^v^<^<v^>v<v>^>>vv^v^v^^><^<<>v>^^>v^^^<<^^vv^^^><^<v^<vv>v^<><<^^^^>><v<<<vv^<^vv<^^v^^^<>v^<^v>^v<v<^v<^>>^><>>v^<^v^><^v^v>>>v^^>vvv<<><><v><v^>^v>><v>^>>^v><^<^<<vv>^vvv><<>><^v>><vv^<><<v>v^<>v<<<<v^>^>><<<><>^<<^<vvv<>v^<<<<>><><>>^<v<^<>>^v^^v^v<^v>v^v^^<><>^v><<>^<v^<^vvv^v^^^v>v>v<<^^><<v<v<vvv><<^^<^^<v^<v>><^<v>>>v^^<><v>v^v<v^vvvvv>^v^<v^v>^^<v>>^^^><>v^^<^vv>^<^<>^<><>^>v^^><<<^>>v^>^v>v<>v<vv>><vvv<^^><<>v<<^vvv><>v<^v<<^vv^><<<<v><^v>^>v^vv^vvv><>><v>vv<^v^<<<^>><<^><>^><<>^<^>v><>v><^
<v>v<v^^><>^<v><vv^<^vv^^^<<<v><^>>>v^<>><<v<>^><>^>vv^>vvv>v><v^^><v<v><^^<^v<vv^><>^v>>v^>>^^^v^<vvv^>>v^^^><<^>>>^^>v^v^v^<<^^<<><><^^<^^^<<<vv<^^^<v^>vv^^<^^v>^><<<>vvv^^<v<vv<^^^^>v>v<vv>vvv^<>>^><<>^vv>>>^v>>v>^^>^><<vvvv<>^>^<v^v<v><^v^<v^vv^><^v<>v<><<>^<<^vv^vv<>>^^v^vv><>^<^>><><<^v<<^v>><v<v><>^><^vv<<^<vvv>^<v>^v^^vv<v>><><^>v>^><v><^<^<^>^<<>^<vv>v><v<<>>>vv>><^>>vvv<^<vvvv^<^<<>^v<v^<><<<>^<>>>v^v^v^><<v^^v^vvv<v<<^<<vvvv<^^>v>><^<>v>^>v<^^v<><v>^^^vv<^v^>>^^v<^<^v^^v<v>^v^^^<vv>^<<>^^vv>^^>v><^>><vv>>vvv<v<>v<>^>^<<><<^><>vv<>>>^vv>>>>v>^<v^v>>v>^<^<<<v<^^v>vvvvv^<v^v<^><>^>v>v^<^^^^^<vv>>v><>^v^<^v^v>^v^^<^<<^^<v>^v^^>^v<^v>^vvv<<vv^>^^v<v>vvvv^<>><<v>v^vv^<<<>vv^>^<v^^>^>v^<^<v<^^v^^^vv<><<<v>v<^<><>v<<>^<^>^><^v^^v>vvv^>^<vv^>vvv><><v>v>vv>>v><>><<<><^>vv^^^v<<^^<<v^><<v<>^>^<v><^^^v<>v<><<><<<v<<>>v^^<^<><vv<^^v<><><<><>>^^v^vv^v>^><^<<>v^<^^<><vv<^<><v^^<><<vvvvv<<v>^^^<v<<>v<>v<v<><>>^v<^<^v<<<>^v<<v><<<<<vv<^<v^<v><vv^^v<vvv<^v>^^^>^<^><^>^<^>>vv^<>v^>>^<^><>v>>v>
>v<<<^>^<<v>^<^^>>^<>>^>^<^<>^>^^^<><^>v<<vv>v>vvv<^><^v>vv>>^>^v^<^v>>^v^v<^>^<><^>^>><<v<vv>^<<>v>v<>v>v<vv<^<^><>>v^>v<<^<>>v><<<<^<v<^>>vvvvv>vvv>vv<<>>>>vv>vvv^<^v^v>v>v<<<<>^<v^^v>>^<><^^v><<>^^v^^v>v><vvvv^v<^>^v^^v>^<v<vv^<^>v><v<<v^^^v^v<v<>^vv^<^^^><v<^<<>^vv^v<v^^<v^>^>v<vv>>v>>v><<^^<v<v<^>v^^v^v^>>v^>^^^^<v<v<vv>v<v>vvv>>^v^vv<^>>v>><v^>v>vv<^>v^v^^><v<<v^v^v<>>v<<<v<^<<^<<v^>><^<vv<>v<>>><vvvvv^<<vv^<^<^><<v<>^^^>^>^<><<v<>^<<<>>v><>><^vv^><<^<>v>^v<>^^^v^<^<<vv<<<>^^>v><^^^><>>v^v>^>^>>^v^v>>^v<^^>^^>>><<^^>^v><<v><^<v<>>^vv<<<>v>vv^vvvv^^>><<v>>v>v<>>>>v<<vv<^^<^v<^^>v>^<vv><v>vv^^v<v<>v><v^>>^>^<^>>>>^^v<v<^>>>>v>^^>>^^>^>v><^>v^<^v<<v<^v<<vvv^^>^^><v>v^>>^>v><v^v<v>>^^^<^<>^>v^v<^^^^<v<<^<>v>>^<v^<<>v^^<<^<v^<>^>^<v^<v^^<>>v^<<^>v^>vv<^v^vv>^^vv>^v><>><<vv^^<>^v><<><v^v^v>^v<>^<^^^>>^^vv^vv>^v^vvv>v<^<<<>^><>v^v<>v<<><^v<<>>>v><>^>^^v^<^v><<^^^^><^>v<>^<v><>^<^<<^^><v<><><<>^vvv><<^^v>>v^^^v^^>v>^^><>^vv><^^<<<^^><<v>v^>^>^>^<>>><<v^^^><^v<<>^<^<^v><v^>>vv<<>v^>>>v<v>
v^^<>>>v<v^>^v><vv^<^^^<v^>^<vvvv^^^^vvv<v><^vvv<^^v^<<><>>><<^v^<><^^vv<>^<v^v><vv^<>vv<^<^^>v>>>v^v<>^<>^vv^vvv^>^<><v^v<^<<v<<v^^<^<vvv<vvvvv>^v>vv>^<vv>><v>^<<^^^>>><v^v>><<<>^>>v^^^v^^<v^vvv<><vvv>v><^v<vv><<<>><>>^<v><<^>^>>^><>v<v><>v<>>>>>>^<^<^vv<>v>^>^<<^<^^^^^^v><^v^^<v><<>^>v<v<<<^>^v^<<^<^<>^<>><vv<v^^v<<vv^^<v^^>>><<<<v^v>>v^><>^><^v>>><>^>>v^<^^^^>v^<v<><>>^>>v>^v>>^<v>>v>^^^<<<^^<>>>>^>vv>^v^^<<^<^<<><^>v>v^v<><>>^v^>^^^^^v^<vv><v^v^v<^<<>^^v^<v<vv>^>>v><>^><<>><><<vv^^<^<v<^^>>^^v<vvvvv^v>v^v>^v^v>><v>^>><^^><>>v<<<>><^vv^<<<^^^><>^><^>v>v>v^vv^>^^^vv^^><^^><><<^<<vv^^v>v>v>^><<<<^^v^^^v^>>vv<<<>vv>>>^v>v>><>v<v^<>^^>><<><v<<^^<^>vv<<<<>>^><<<>>^>>>>v<^v^>v><><>v^^^<<^^vv<>^vvvv><>v^v><<><v>^vv<vv<<>>^^>>v>><^<<vv^<>v^<^^>>v>>^^>v^^vv^<v>^<^^<><^><v<v>v<>^>>v<<<vvvv<^>v^vv>^v<vv>>v<vv^v><<v<^<><v><v^v><<^>^<v^>^v>vv><>><<>v>>v>>>><vv<v<>^^<v<^<<>^>^^<vv>>^vvv^vvv>^^<<>>^v^^<>>v>v^>^^^v>>v>^>^v<^>^<><<v>^<v<vv^<vv^v^<v>>^v>^><^v>v>>>v<><vv>v^<^>vv^><v^vv<v><v^v><<<vv^<v
<^>^<<v^<vv^^^^>v<>v<^>^^^v^><^><<v<v^v<vv><^v<>^<v^>v><>v><^<<><<v<^v^<v<><v^v>^<<>^>^<v<^^<^<>^^<v><>^^v^<v>><>^v><v^^vv<><v>^<v^^<><vv^>><>><<>>>vv<<^^^>^>^<><<^><>^<<>><^<^>vv><<<<^>^<<^<<v><^^v<^<<v>^v^<^<v<>v^v<vvvv^v^^v>v>><v<v>>v^>vvv>>>vvv^v^^<>><vv>>^<><>>v<^v^^v^<>^^v>>^^>><^>><v<><<<^v^>v><v>^v><vv<<<<v^v<<>v<<<><>>^>>^^<v<>v>>v>^>^^<<vv<<<^v>><^><^v><^>v^>^<>^^^vv<>vv>^vvvv<<><<v>>^v<vv^^<>v^>^<v><>v<v<^vv>vv^vv<^^<>v<><v<vvvv>><^>>^v>^<<>^>v>vv^>>^<^^v<^>v<<^^><<^^>>>>>^^^v<v^^<><^<>^v><<>^<<vv<<^^vvv<^<^<<vv^v<v<>^<v^v<<<<^^^vv<<><^<^^v<^vv>^<<v^<><>^vv^>^<<<>>vv^<<<v>^>>>^<<v<<<^v^><>^>^<v<>^^v<><v>>^^<<>v<v^v^v<>^>^><v>v>>><^^^<^v<>>^^^<><^vv^<^v><<<vvv<v><<v^>vvv<v>>^^^>><^^<><<^v^<^^<v<^<<^<>>>>^>>v^<<><<^v^v^v<vv<v<<<<v>^^>><^v>><^>>vv>^<v^<^v^^<><vv>v^v^^<<>>^>>^<^^^<^<^v>^<<^<vv<>v<><^v>v^>>vv^^><<<<vv<<v>v^><^<>vv<v><^<><v<><v>^^v<<^<>^><><>^vv^vv^^vv<^vv<>><^<v<^>>>v>>v<>^^>v^^>v^>^<>><v^^>v^^>vv<^<<^v<vv>>^vvv>><v^<^<<><v>>^v<<^v><<^v<>>>>^<<<<<^<<><<v>>v<^>><<
>^<<>vv<^<<>^v^^v<^^^<^>>^><vvv^^^v^<v><^><>>>><v<<v^vv^^^^^<^^vvv>v^^<^^><^^^vv>v^v<v<^v^v>^^^<><<^<<^v>>^v^^>v^v<v><<v^>>^^<^vv><v^v^<^<v>v><>^>^>vvv<>>^v>^v>><>^^v>^>^^vvv><<><v^<>vv><>^>><<<^<vv<v^v>>v>v<<>vv>><><v>v<>^<v>v^<><>v>vv>^v>v<vv<^>v<<>>^<^^>v^v><vv<<>>v><>>>>^><<<<v>>^^<<<^>v<v<<<><<<vv>^>^vv^<<^v>>v<v^vvv><vvv<^>^vv>>v^v^^v^^<<v>>^^^^^^>v<>^v<v^v>v<^^^>^<<>>vv<>v>v<<v^<>^<>^vvv>v^vv<>>^^>>>>^vv>^^>^v<^^>^>><^^>>^v><<^vv<v^v<v^vv^v<<><<^vv^^vv>^v>^^>>^v<><><<v^v><<>^<^>>vv<^<v<vv<>>^>>^>^v<v<<>^<v><>^<>^^^<>vv^<<>vv><<v^>^^vv^vv<<<^v^>>>v^v>^v^^v^>v<vv^^<v^^^<<<v^>>><^<v<v<^><^v^<>v><^^><^<>v>>vv<<>^>>^vvv^^>^<^v^<v>v<<>v^>>^<>>v>vv>>v>>>^<vv<vv>v^v>v<v>^v^>v^^^vvv<^<>v^<^>vv<>>vv<^^v>v^>^<^^^<<<v<<<<^^^^v^v^vvv>v^^vv<^>v<v^<^>>>>>v^^v><>v^<><>v^v^<^<>>^^<<<v<^v^>>>^^^<<^>><<<<vv>v^^^^>^>v^>^v<^<^<v<<v<vvv^><v>>>vv>^v<>v>><<v>>^^v>^v^<>v<v^v<<^v><vvv<v^v>>^^v^><^<v^^^^<>^v<v>v^v^^v<^^>v^^^v>v<<vv<^><v>vv<><>>^v^>v^vvv>>v^v^v>^<>^v>v><>^v^^<v<^>>><<>^>v>>^v>>^v<vvvv><<>v
><v<>^^>^vv>vv>>>><<^v^<v>^<^<v<^>>^>v^v<<>^^^<v>vv>>^><>>v<>^><<><<>v>^><^^<<^^><>v<vvv^>>^^>><^<^<>v^v^>><vv<<>><^<><<^v^>vv<v<<>vvv<^v><v<<<<>>v<<>v>v^<vv<vvv>v>><^vv>v<<><^vv><>><v>>vv^<vv^<<v>vvv<^^>^><<vv<^>>><^v<v<<^>^v<<><<v^>vvv<v>vvv<v<^^>>^v^><^^>v<>><<^><>v>><>^vv<>><<<v<^<vv>^<^<^<>><v^^v<^^^>>v<v><<v^v<v^vv^^v><v<v><><<>^v><vv^v>^^v<vvv<<<<^>><^vv<^v>><<v<<>v><>^<<>>>><<^<vv^v<v>><<>>>v^<vv<v<<<>v^v>^v^vv<v^v^^^<>>>v<^v^<<<<^v^<vv>>^<<<^^>>>^<v>^>>>>^^v<<><>>^<<<<<<><v<v^<^^vv>^^^v^>>v<v^^><<v<>^>^><v>>>^vv^^<>^^v><<v>^>^>^v<vv<<<>>>^^v<^^<<^<><<^>>^>vv>^>>^>v>>^^>>>>^^<>^<><<<<><>>v>v^<v^^^vv>>>>>v^^^<^^vv^v^>><>^^^^v><^<v<v^v<<v<^v<vv<>v^v<>>v<^v^v<v^<vvv><v>v^>v<<^^<<<v^<>^>>^^<<^>vvv<>vvvvv>v^><<<>>^>>^^>v^>^<^><><v<<^^<<v^<v>^<vv>><><<><>^<><^v>^><^><<v<<<<^^<<>>v^<<>v>^vv<v<^^^vvv<v<v<<<vvv><^>v>vv<<>>v>^<<<>v>v<<vv>v>^>vvvv>^><^^>>v^v<v>^<v>>^^v>^><v^^^v^>vv>^vv<<<v><v^<v^^>^v<<v<v^>^vv><^v^><^<>v^v<<<vv<<^v>>^^^<><<<v^<>>^^><>>vvvv^^<><v<<<>v^>^v<<>vvv^v>^<<^<v<>>";
const string inputTest = @"##########
#..O..O.O#
#......O.#
#.OO..O.O#
#..O@..O.#
#O#..O...#
#O..O..O.#
#.OO.O.OO#
#....O...#
##########

<vv>^<v^>v>^vv^v>v<>v^v<v<^vv<<<^><<><>>v<vvv<>^v^>^<<<><<v<<<v^vv^v>^
vvv<<^>^v^^><<>>><>^<<><^vv^^<>vvv<>><^^v>^>vv<>v<<<<v<^v>^<^^>>>^<v<v
><>vv>v^v^<>><>>>><^^>vv>v<^^^>>v^v^<^^>v^^>v^<^v>v<>>v^v^<v>v^^<^^vv<
<<v<^>>^^^^>>>v^<>vvv^><v<<<>^^^vv^<vvv>^>v<^^^^v<>^>vvvv><>>v^<<^^^^^
^><^><>>><>^^<<^^v>>><^<v>^<vv>>v>>>^v><>^v><<<<v>>v<v<v>vvv>^<><<>^><
^>><>^v<><^vvv<^^<><v<<<<<><^v<<<><<<^^<v<^^^><^>>^<v^><<<^>>^v<v^v<v^
>^>>^v>vv>^<<^v<>><<><<v<<v><>v<^vv<<<>^^v^>^^>>><<^v>>v^v><^^>>^<>vv^
<><^^>^^^<><vvvvv^v<v<<>^v<v>v<<^><<><<><<<^^<<<^<<>><<><^^^>^^<>^>v<>
^^>vv<^v^v<vv>^<><v<^v>^^^>>>^^vvv^>vvv<>>>^<^>>>>>^<<^v>^vvv<>^<><<v>
v^^>>><<^^<>>^v^<v^vv<>v^<<>^<^v^v><^<<<><<^<v><v<>vv>>v><v^<vv<>v^<<^";

const string inputTest2 = @"#######
#...#.#
#.....#
#..OO@#
#..O..#
#.....#
#######

<vv<<^^<<^^";

const string inputTest3 = @"#######
#...#.#
#.....#
#..OO.#
#..#@.#
#.....#
#######

^^<^>v>^";

void Part1(string input) {
    var lines = input.Split(Environment.NewLine).ToList();
    var grid = lines.Take(lines.IndexOf("")).Select(l => l.ToCharArray()).ToArray();
    var directions = lines.Skip(lines.IndexOf("") + 1).Aggregate("", (s, current) => s+current );
    var current = grid.FindCell('@');

    bool TryMove(int i, int j, Grid.Direction direction) {
        char currentChar = grid[i][j];
        if( direction == Grid.Direction.Up && grid.HasCell(i - 1, j) && grid[i - 1][j] != '#') {
            if( grid[i - 1][j] == 'O' && TryMove( i - 1, j, direction)) {
                grid[i][j] = '.';
                grid[i - 1][j] = currentChar;
                return true;
            }
            if( grid[i - 1][j] == '.' ) {
                grid[i][j] = '.';
                grid[i - 1][j] = currentChar;
                return true;
            }
        }
        if( direction == Grid.Direction.Down && grid.HasCell(i + 1, j) && grid[i + 1][j] != '#') {
            if( grid[i + 1][j] == 'O' && TryMove( i + 1, j, direction)) {
                grid[i][j] = '.';
                grid[i + 1][j] = currentChar;
                return true;
            }
            if( grid[i + 1][j] == '.' ) {
                grid[i][j] = '.';
                grid[i + 1][j] = currentChar;
                return true;
            }
        }
        if( direction == Grid.Direction.Left && grid.HasCell(i, j - 1) && grid[i][j - 1] != '#') {
            if( grid[i][j - 1] == 'O' && TryMove( i, j - 1, direction)) {
                grid[i][j] = '.';
                grid[i][j - 1] = currentChar;
                return true;
            }
            if( grid[i][j - 1] == '.' ) {
                grid[i][j] = '.';
                grid[i][j - 1] = currentChar;
                return true;
            }
        }
        if( direction == Grid.Direction.Right && grid.HasCell(i, j + 1) && grid[i][j + 1] != '#') {
            if( grid[i][j + 1] == 'O' && TryMove( i, j + 1, direction)) {
                grid[i][j] = '.';
                grid[i][j + 1] = currentChar;
                return true;
            }
            if( grid[i][j + 1] == '.' ) {
                grid[i][j] = '.';
                grid[i][j + 1] = currentChar;
                return true;
            }
        }

        return false;
    }

    foreach (var move in directions) {
        TryMove(current.i, current.j, move switch {
            '^' => Grid.Direction.Up,
            'v' => Grid.Direction.Down,
            '<' => Grid.Direction.Left,
            '>' => Grid.Direction.Right,
            _ => throw new ArgumentOutOfRangeException()
        });
        current = grid.FindCell('@');
        Console.WriteLine($"Move {move}:");
        //grid.Print();
    }

    long sum = 0;
    for (int i = 0; i < grid.Length; i++) {
        for (int j = 0; j < grid[i].Length; j++) {
            if (grid[i][j] == 'O') {
                sum += 100* i + j;
            }
        }
    }
    Console.WriteLine(sum);
}

void Part2(string input) {
    var lines = input.Split(Environment.NewLine).ToList();
    var grid = lines.Take(lines.IndexOf("")).Select(l => l.SelectMany<char, char>(c => c switch
    {
        '@' => ['@', '.'],
        '.' => ['.','.'],
        'O' => ['[',']'],
        '#' => ['#','#'],
        _ => throw new ArgumentOutOfRangeException(nameof(c), c, null)
    }).ToArray()).ToArray();
    var directions = lines.Skip(lines.IndexOf("") + 1).Aggregate("", (s, current) => s+current );
    var newGrid = new char[grid.Length][];
    for (int i = 0; i < grid.Length; i++) {
        newGrid[i] = new char[grid[i].Length];
    }
    
    var originalGrid = new char[grid.Length][];
    for (int i = 0; i < grid.Length; i++) {
        originalGrid[i] = new char[grid[i].Length];
    }
    Copy(grid, originalGrid);


    bool TryMove(int i, int j, Grid.Direction direction)
    {
        char currentChar = grid[i][j];
        if( currentChar is '#') {
            return false;
        }
        if( currentChar is '.') {
            return true;
        }
        if( currentChar is '[' or ']') {
            return TryMoveBox(i, j, direction);
        }

        if (direction == Grid.Direction.Up && grid.HasCell(i - 1, j)) {
            if (TryMove(i - 1, j, direction)) {
                newGrid[i][j] = '.';
                newGrid[i - 1][j] = currentChar;
                return true;
            }
        }
        if (direction == Grid.Direction.Down && grid.HasCell(i + 1, j)) {
            if ( TryMove(i + 1, j, direction)) {
                newGrid[i][j] = '.';
                newGrid[i + 1][j] = currentChar;
                return true;
            }
        }
        if (direction == Grid.Direction.Left && grid.HasCell(i, j - 1)) {
            if ( TryMove(i , j-1, direction)) {
                newGrid[i][j] = '.';
                newGrid[i][j - 1] = currentChar;
                return true;
            }
        }
        if (direction == Grid.Direction.Right && grid.HasCell(i, j + 1)) {
            if ( TryMove(i, j + 1, direction)) {
                newGrid[i][j] = '.';
                newGrid[i][j + 1] = currentChar;
                return true;
            }
        }

        return false;
    }

    bool TryMoveBox(int i, int j, Grid.Direction direction) {
        char currentChar = grid[i][j];
        if (currentChar == ']') {
          return TryMoveBox(i, j - 1, direction);
        }
        if (currentChar != '[') {
          throw new ArgumentException("No box");
        }
        if( direction == Grid.Direction.Up && grid.HasCell(i - 1, j)) {
            if (TryMove(i - 1, j, direction) && TryMove(i - 1, j + 1, direction)) {
                newGrid[i][j] = '.';
                newGrid[i][j + 1] = '.';
                newGrid[i - 1][j] = '[';
                newGrid[i - 1][j + 1] = ']';
                return true;
            }
        }
        if( direction == Grid.Direction.Down && grid.HasCell(i + 1, j)) {
            if (TryMove(i + 1, j, direction) && TryMove(i + 1, j + 1, direction)) {
                newGrid[i][j] = '.';
                newGrid[i][j + 1] = '.';
                newGrid[i + 1][j] = '[';
                newGrid[i + 1][j + 1] = ']';
                return true;
            }
        }
        if( direction == Grid.Direction.Left && grid.HasCell(i, j - 1)) {
            if( TryMove( i, j - 1, direction)) {
                newGrid[i][j] = ']';
                newGrid[i][j - 1] ='[';
                newGrid[i][j + 1] = '.';
                return true;
            }
        }
        if( direction == Grid.Direction.Right && grid.HasCell(i, j + 2)) {
            if( TryMove( i, j +2, direction)) {
                newGrid[i][j] = '.';
                newGrid[i][j + 1] ='[';
                newGrid[i][j + 2] = ']';
                return true;
            }
        }

        return false;
    }

    for (var index = 0; index < directions.Length; index++) {
        var move = directions[index];
        Console.WriteLine($"move {index}");
        Copy(grid, newGrid);
        var current = grid.FindCell('@');
        bool success = TryMove(current.i, current.j, move switch
        {
            '^' => Grid.Direction.Up,
            'v' => Grid.Direction.Down,
            '<' => Grid.Direction.Left,
            '>' => Grid.Direction.Right,
            _ => throw new ArgumentOutOfRangeException()
        });
        if (index == 2608)
        {
            Console.WriteLine("grid before:");
            grid.Print();
        }

        if (success) {
            Copy(newGrid, grid);
        }

        Console.WriteLine($"Move {move}:");
        Copy( originalGrid, newGrid);
        if (index == 2608 )
        {
            grid.Print();
            Console.WriteLine("grid should be:");
            ExecuteMovesPart2b(newGrid, directions, index + 1);
            /*for (int i = 0; i < grid.Length; i++) {
                for (int j = 0; j < grid[i].Length; j++) {
                    if (newGrid[i][j] != grid[i][j])
                    {
                        throw new Exception("failed on index " + index);
                    }
                }
            }*/
        }
        
        //grid.Print();
    }

    long sum = 0;
    for (int i = 0; i < grid.Length; i++) {
        for (int j = 0; j < grid[i].Length; j++) {
            if (grid[i][j] == '[') {
                sum += 100* i + j;
            }
        }
    }
    grid.Print();
    Console.WriteLine(sum);
}


void ExecuteMovesPart2b(char[][] grid, string directions, int maxMove = -1) {
    if( maxMove == -1) {
        maxMove = directions.Length;
    }
    var toMove = new List<(int i, int j, char c)>();

    char NextInGrid((int i, int j) pos, Grid.Direction direction) {
        var next = Next(pos, direction);
        return grid[next.i][next.j];
    }
   
    bool CanMove(int i, int j, Grid.Direction direction) {
        toMove.Clear();
        toMove.Add((i, j, grid[i][j]));
        if (grid[i][j] != '@') {
            throw new Exception();
        }
        var toPush = new List<(int i, int j)>();
        toPush.Add((i, j));
        while (true) {
            if( toPush.All( p => NextInGrid(p, direction) == '.')) {
                return true;
            }
            if( toPush.Any( p => NextInGrid(p, direction) == '#')) {
                return false;
            }

            var newPush = new List<(int i, int j)>();
            bool upDown = direction is Grid.Direction.Up or Grid.Direction.Down;
            foreach( var current in toPush) {
                var next = Next(current, direction);
                var nextChar = grid[next.i][next.j];
                if (nextChar is '[') {
                    newPush.Add(next);
                    if (upDown) {
                        newPush.Add(Next((current.i, current.j + 1), direction));
                    }
                }
                if (nextChar is ']') {
                    newPush.Add(next);
                    if (upDown) {
                        newPush.Add(Next((current.i, current.j - 1), direction));
                    }
                }
            }
            toPush = newPush;
            toMove.AddRange(toPush.Select( c => (c.i, c.j, grid[c.i][c.j])));
        }
    }


    for (var index = 0; index < maxMove; index++) {
        var move = directions[index];
        //Console.WriteLine($"move {index}");
        var current = grid.FindCell('@');
        var direction = move switch
        {
            '^' => Grid.Direction.Up,
            'v' => Grid.Direction.Down,
            '<' => Grid.Direction.Left,
            '>' => Grid.Direction.Right,
            _ => throw new ArgumentOutOfRangeException()
        };
        bool success = CanMove(current.i, current.j, direction);
        if (success) {
            foreach (var moved in toMove) {
                grid[moved.i][moved.j] = '.';
            }

            foreach (var moved in toMove) {
                if (moved.c is '.' or '#') {
                    throw new Exception();
                }
                var next = Next((moved.i, moved.j), direction);
                grid[next.i][next.j] = moved.c;
            }
        }

        //Console.WriteLine($"Move {move}:");
        //grid.Print();
    }

    long sum = 0;
    for (int i = 0; i < grid.Length; i++) {
        for (int j = 0; j < grid[i].Length; j++) {
            if (grid[i][j] == '[') {
                sum += 100* i + j;
            }
        }
    }
    grid.Print();
    //Console.WriteLine(sum);
}

void Part2b(string input) {
    var lines = input.Split(Environment.NewLine).ToList();
    var grid = lines.Take(lines.IndexOf("")).Select(l => l.SelectMany<char, char>(c => c switch
    {
        '@' => ['@', '.'],
        '.' => ['.','.'],
        'O' => ['[',']'],
        '#' => ['#','#'],
        _ => throw new ArgumentOutOfRangeException(nameof(c), c, null)
    }).ToArray()).ToArray();
    var directions = lines.Skip(lines.IndexOf("") + 1).Aggregate("", (s, current) => s+current );

    ExecuteMovesPart2b(grid, directions);
}

static ( int i, int j) Next((int i, int j) pos, Grid.Direction direction) {
    return direction switch
    {
        Grid.Direction.Up => (pos.i - 1, pos.j),
        Grid.Direction.Down => (pos.i + 1, pos.j),
        Grid.Direction.Left => (pos.i, pos.j - 1),
        Grid.Direction.Right => (pos.i, pos.j + 1),
        _ => throw new ArgumentOutOfRangeException()
    };
}

static void Copy( char[][] source, char[][] dest) {
    for (int i = 0; i < source.Length; i++) {
        for (int j = 0; j < source[i].Length; j++) {
            dest[i][j] = source[i][j];
        }
    }
}

Part2(inputReal);// 1519527 too long, 1527969 is good